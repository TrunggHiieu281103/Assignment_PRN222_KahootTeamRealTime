@page
@model KahootTeamRealTime.Pages.QuizRealTime.AnswerQuizModel
@{
    ViewData["Title"] = "Answer Quiz";
}
<h2>Room Code: <span id="roomCode">@Model.RoomCode</span></h2>
<h2>Username: <span id="username">@Model.Username</span></h2>

<div class="quiz-container">
    <h1>Quizzing!</h1>

    @if (!string.IsNullOrEmpty(Model.Question))
    {
        <h3>@Model.Question</h3>

        <div id="timer" class="timer">10</div> <!-- Hiển thị thời gian còn lại -->

        <form method="post" class="quiz-form" id="quizForm">
            <input type="hidden" name="roomCode" value="@Model.RoomCode" />
            <input type="hidden" name="username" value="@Model.Username" />

            @foreach (var answer in Model.Answers)
            {
                <label class="answer-option">
                    <input type="radio" name="SelectedAnswer" value="@answer.Id" required>
                    <span>@answer.Content</span>
                </label>
            }

            <button type="button" class="submit-btn" id="submitBtn">Submit</button>
        </form>

        <div id="resultMessage" class="hidden"></div> <!-- Hiển thị kết quả -->
    }
    else
    {
        <p>No questions available.</p>
    }
</div>

<script>
    let timeLeft = 10;
    let timerElement = document.getElementById("timer");
    let resultMessage = document.getElementById("resultMessage");
    let quizForm = document.getElementById("quizForm");
    let submitBtn = document.getElementById("submitBtn");

    function startTimer() {
        let countdown = setInterval(() => {
            timeLeft--;
            timerElement.innerText = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(countdown);
                submitAnswer(); // Tự động gửi khi hết thời gian
            }
        }, 1000);
    }

    function submitAnswer() {
        submitBtn.disabled = true; // Vô hiệu hóa nút submit

        let selectedAnswer = document.querySelector('input[name="SelectedAnswer"]:checked');
        if (!selectedAnswer) {
            resultMessage.innerText = "You didn't choose an answer!";
            resultMessage.style.color = "red";
        } else {
            fetch(window.location.pathname, {
                method: "POST",
                body: new FormData(quizForm),
            })
            .then(response => response.json())
            .then(data => {
                if (data.isCorrect) {
                    resultMessage.innerText = "Correct Answer!";
                    resultMessage.style.color = "green";
                } else {
                    resultMessage.innerText = "Wrong Answer!";
                    resultMessage.style.color = "red";
                }

                resultMessage.classList.remove("hidden");

                setTimeout(() => {
                    window.location.reload(); // Chuyển sang câu tiếp theo sau 4 giây
                }, 4000);
            });
        }
    }

    submitBtn.addEventListener("click", submitAnswer);
    startTimer();
</script>
